<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrintStack Performance Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; }
        .pass { color: green; }
        .fail { color: red; }
        button { margin: 5px; padding: 8px 16px; }
    </style>
</head>
<body>
    <h1>PrintStack Performance Testing</h1>
    <p>Testing interaction times against Constitution requirements (<100ms target)</p>

    <div class="test-section">
        <h2>Form Validation Performance</h2>
        <button onclick="testFormValidation()">Test Form Validation</button>
        <div id="validation-results"></div>
    </div>

    <div class="test-section">
        <h2>Data Loading Performance</h2>
        <button onclick="testDataLoading()">Test Data Loading</button>
        <div id="loading-results"></div>
    </div>

    <div class="test-section">
        <h2>Table Rendering Performance</h2>
        <button onclick="testTableRendering()">Test Table Rendering</button>
        <div id="table-results"></div>
    </div>

    <div class="test-section">
        <h2>Search/Filter Performance</h2>
        <button onclick="testSearchFilter()">Test Search & Filter</button>
        <div id="search-results"></div>
    </div>

    <div class="test-section">
        <h2>LocalStorage Operations</h2>
        <button onclick="testLocalStorage()">Test LocalStorage</button>
        <div id="storage-results"></div>
    </div>

    <div class="test-section">
        <h2>All Tests Summary</h2>
        <button onclick="runAllTests()">Run All Performance Tests</button>
        <div id="summary-results"></div>
    </div>

    <script>
        // Performance testing utilities
        class PerformanceTester {
            static measureTime(testFunction, iterations = 1) {
                const times = [];
                for (let i = 0; i < iterations; i++) {
                    const start = performance.now();
                    testFunction();
                    const end = performance.now();
                    times.push(end - start);
                }
                return {
                    average: times.reduce((a, b) => a + b, 0) / times.length,
                    min: Math.min(...times),
                    max: Math.max(...times),
                    times: times
                };
            }

            static createTestDataSet(size = 1000) {
                const data = [];
                for (let i = 0; i < size; i++) {
                    data.push({
                        id: Date.now() + i,
                        brand: `Brand ${i % 10}`,
                        materialType: ['PLA', 'PETG', 'ABS', 'TPU'][i % 4],
                        colorName: `Color ${i % 50}`,
                        colorHex: `#${Math.floor(Math.random()*16777215).toString(16).padStart(6, '0')}`,
                        weight: Math.floor(Math.random() * 1000) + 100,
                        inStock: Math.random() > 0.3
                    });
                }
                return data;
            }

            static displayResults(containerId, testName, results, targetMs = 100) {
                const container = document.getElementById(containerId);
                const passed = results.average <= targetMs;

                container.innerHTML += `
                    <div class="result ${passed ? 'pass' : 'fail'}">
                        <strong>${testName}</strong><br>
                        Average: ${results.average.toFixed(2)}ms<br>
                        Min: ${results.min.toFixed(2)}ms<br>
                        Max: ${results.max.toFixed(2)}ms<br>
                        Status: ${passed ? '✅ PASS' : '❌ FAIL'} (Target: ${targetMs}ms)
                    </div>
                `;
            }
        }

        function testFormValidation() {
            const container = document.getElementById('validation-results');
            container.innerHTML = '<p>Testing form validation performance...</p>';

            // Create a test form
            const form = document.createElement('form');
            form.innerHTML = `
                <input type="text" name="brand" value="Test Brand" required>
                <input type="text" name="materialType" value="PLA" required>
                <input type="text" name="colorName" value="Test Color" required>
                <input type="text" name="colorHex" value="#FF0000" required>
                <input type="number" name="weight" value="500" required>
            `;
            document.body.appendChild(form);

            // Test validation performance
            const mockValidators = {
                brand: { required: true, minLength: 2 },
                materialType: { required: true },
                colorName: { required: true, minLength: 2 },
                colorHex: { required: true, pattern: /^#[0-9A-Fa-f]{6}$/ },
                weight: { required: true, type: 'number', min: 0.1 }
            };

            function validateFormFast(form) {
                const inputs = form.querySelectorAll('input');
                for (const input of inputs) {
                    const rule = mockValidators[input.name];
                    if (rule && rule.required && !input.value) return false;
                    if (rule && rule.pattern && !rule.pattern.test(input.value)) return false;
                }
                return true;
            }

            const results = PerformanceTester.measureTime(() => {
                validateFormFast(form);
            }, 100);

            document.body.removeChild(form);
            PerformanceTester.displayResults('validation-results', 'Form Validation', results, 50);
        }

        function testDataLoading() {
            const container = document.getElementById('loading-results');
            container.innerHTML = '<p>Testing data loading performance...</p>';

            const testSet = PerformanceTester.createTestDataSet(1000);

            function loadData(data) {
                // Simulate data processing
                const processed = data.map(item => ({
                    ...item,
                    displayName: `${item.brand} ${item.materialType} ${item.colorName}`,
                    available: item.inStock && item.weight > 50
                }));
                return processed;
            }

            const results = PerformanceTester.measureTime(() => {
                loadData(testSet);
            }, 10);

            PerformanceTester.displayResults('loading-results', 'Data Loading (1000 records)', results, 100);
        }

        function testTableRendering() {
            const container = document.getElementById('table-results');
            container.innerHTML = '<p>Testing table rendering performance...</p>';

            const testSet = PerformanceTester.createTestDataSet(500);

            function renderTable(data) {
                const table = document.createElement('table');
                const tbody = document.createElement('tbody');

                data.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.brand}</td>
                        <td>${item.materialType}</td>
                        <td>${item.colorName}</td>
                        <td>${item.weight}g</td>
                    `;
                    tbody.appendChild(row);
                });

                table.appendChild(tbody);
                document.body.appendChild(table);
                return table;
            }

            const results = PerformanceTester.measureTime(() => {
                const table = renderTable(testSet);
                document.body.removeChild(table);
            }, 10);

            PerformanceTester.displayResults('table-results', 'Table Rendering (500 rows)', results, 200);
        }

        function testSearchFilter() {
            const container = document.getElementById('search-results');
            container.innerHTML = '<p>Testing search & filter performance...</p>';

            const testSet = PerformanceTester.createTestDataSet(1000);

            function searchFilter(data, query) {
                const lowerQuery = query.toLowerCase();
                return data.filter(item =>
                    item.brand.toLowerCase().includes(lowerQuery) ||
                    item.materialType.toLowerCase().includes(lowerQuery) ||
                    item.colorName.toLowerCase().includes(lowerQuery)
                );
            }

            const results = PerformanceTester.measureTime(() => {
                searchFilter(testSet, 'brand');
            }, 100);

            PerformanceTester.displayResults('search-results', 'Search/Filter (1000 records)', results, 100);
        }

        function testLocalStorage() {
            const container = document.getElementById('storage-results');
            container.innerHTML = '<p>Testing LocalStorage operations...</p>';

            const testKey = 'performanceTest';
            const testData = PerformanceTester.createTestDataSet(100);

            function saveData(key, data) {
                localStorage.setItem(key, JSON.stringify(data));
            }

            function loadData(key) {
                return JSON.parse(localStorage.getItem(key));
            }

            const saveResults = PerformanceTester.measureTime(() => {
                saveData(testKey, testData);
            }, 10);

            const loadResults = PerformanceTester.measureTime(() => {
                loadData(testKey);
            }, 10);

            PerformanceTester.displayResults('storage-results', 'LocalStorage Save (100 records)', saveResults, 100);
            PerformanceTester.displayResults('storage-results', 'LocalStorage Load (100 records)', loadResults, 100);

            // Cleanup
            localStorage.removeItem(testKey);
        }

        function runAllTests() {
            const container = document.getElementById('summary-results');
            container.innerHTML = '<p>Running all performance tests...</p>';

            setTimeout(() => {
                testFormValidation();
                testDataLoading();
                testTableRendering();
                testSearchFilter();
                testLocalStorage();

                setTimeout(() => {
                    const allResults = document.querySelectorAll('.result');
                    const passCount = document.querySelectorAll('.result.pass').length;
                    const failCount = document.querySelectorAll('.result.fail').length;

                    container.innerHTML += `
                        <div class="result ${failCount === 0 ? 'pass' : 'fail'}">
                            <h3>Performance Test Summary</h3>
                            <p>✅ Passed: ${passCount}</p>
                            <p>❌ Failed: ${failCount}</p>
                            <p>Total Tests: ${passCount + failCount}</p>
                            <p><strong>Overall Status: ${failCount === 0 ? 'PASS' : 'FAIL'}</strong></p>
                        </div>
                    `;
                }, 2000);
            }, 100);
        }

        // Page load performance
        window.addEventListener('load', () => {
            const loadTime = performance.now();
            console.log(`Page load time: ${loadTime.toFixed(2)}ms`);

            if (loadTime > 1000) {
                console.warn('Page load time exceeds recommended 1 second');
            }
        });
    </script>
</body>
</html>