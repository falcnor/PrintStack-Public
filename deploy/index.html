<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrintStack</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="sidebar">
        <h1>PrintStack</h1>
        <div class="nav-item active" data-page="filament">Filament Library</div>
        <div class="nav-item" data-page="models">Models Library</div>
        <div class="nav-item" data-page="prints">Print History</div>
        <div class="nav-item" data-page="stats">Statistics</div>
    </div>

    <div class="main-content">
        <div class="container">
            <div id="filament-page" class="page active">
                <h1>Filament Library</h1>
                <div class="section">
                    <h2>Import/Export Data</h2>
                    <button onclick="exportData()">Export All Data</button>
                    <button class="export-btn" onclick="document.getElementById('importFile').click()">Import Data</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                </div>
                <div class="section">
                    <div class="section-header" onclick="toggleSection('materialTypesSection')">
                        <h2>Material Type Management</h2>
                        <span class="toggle-icon" id="materialTypesSection-toggle">‚ñ∂</span>
                    </div>
                    <div class="section-content collapsible" id="materialTypesSection" style="max-height: 0px; overflow: hidden;">
                        <div class="material-types-management">
                            <div class="material-types-list" id="materialTypesList"></div>
                            <div class="material-types-add">
                                <input type="text" id="newMaterialType" placeholder="New material type..." maxlength="50">
                                <button onclick="handleAddMaterialType()">Add Type</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="section">
                    <div class="section-header" onclick="toggleSection('addFilamentSection')">
                        <h2>Add New Filament</h2>
                        <span class="toggle-icon" id="addFilamentSection-toggle">‚ñ∂</span>
                    </div>
                    <div id="addFilamentSection" class="section-content collapsible" style="max-height: 0px; overflow: hidden;">
                        <form id="filamentForm" aria-label="Add new filament">
                            <div class="input-group">
                                    <div class="form-group">
                                        <label for="filamentBrand" id="filamentBrandLabel">Brand</label>
                                        <input type="text" id="filamentBrand" name="brand" placeholder="Manufacturer (e.g., eSUN, Hatchbox)" required aria-required="true">
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentMaterialType" id="filamentMaterialTypeLabel">Material Type</label>
                                        <select id="filamentMaterialType" name="materialType" required aria-required="true">
                                            <option value="">Select Type...</option>
                                            <option value="PLA">PLA</option>
                                            <option value="PETG">PETG</option>
                                            <option value="ABS">ABS</option>
                                            <option value="TPU">TPU</option>
                                            <option value="Other">Other (Custom)</option>
                                        </select>
                                        <input type="text" id="filamentMaterialTypeCustom" name="materialTypeCustom" placeholder="Custom material type" aria-label="Custom material type" style="display: none;">
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentColor" id="filamentColorLabel">Color Name</label>
                                        <input type="text" id="filamentColor" name="colorName" placeholder="Color description" required aria-required="true">
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentColorHex" id="filamentColorHexLabel">Color Code</label>
                                        <input type="color" id="filamentColorHex" name="colorHex" value="#ff5733" aria-describedby="colorContrastInfo">
                                        <small id="colorContrastInfo" class="form-help">Select filament color</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentDiameter" id="filamentDiameterLabel">Diameter</label>
                                        <select id="filamentDiameter" name="diameter" required aria-required="true">
                                            <option value="1.75">1.75mm</option>
                                            <option value="2.85">2.85mm</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentWeight" id="filamentWeightLabel">Weight (g)</label>
                                        <input type="number" id="filamentWeight" name="weight" placeholder="Initial weight" min="0" required aria-required="true">
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentLocation" id="filamentLocationLabel">Storage Location</label>
                                        <input type="text" id="filamentLocation" name="location" placeholder="Storage location">
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentPurchasePrice" id="filamentPurchasePriceLabel">Purchase Price ($/kg)</label>
                                        <input type="number" id="filamentPurchasePrice" name="purchasePrice" placeholder="Optional price per kg" min="0" step="0.01">
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="filamentInStock" name="inStock" value="true" checked>
                                            In Stock?
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <fieldset>
                                            <legend>Temperature Range (¬∞C)</legend>
                                            <div class="temp-range-inputs">
                                                <label for="filamentTempMin" id="filamentTempMinLabel">Min:</label>
                                                <input type="number" id="filamentTempMin" name="tempMin" min="150" max="350" placeholder="150" maxlength="7">
                                                <span class="temp-separator">-</span>
                                                <label for="filamentTempMax" id="filamentTempMaxLabel">Max:</label>
                                                <input type="number" id="filamentTempMax" name="tempMax" min="150" max="350" placeholder="250" maxlength="7">
                                            </div>
                                        </fieldset>
                                    </div>
                                    <div class="form-group">
                                        <label for="filamentNotes" id="filamentNotesLabel">Notes</label>
                                        <textarea id="filamentNotes" name="notes" rows="3" placeholder="Additional notes about this filament"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" id="addFilamentBtn">Add Filament</button>
                                <button type="button" id="cancelFilamentBtn" style="display: none;">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="section">
                    <h2>Filament Inventory</h2>
                    <div id="filamentGridWrapper">
                        <div class="data-grid-controls">
                            <div class="data-grid-search">
                                <input type="text" id="filamentTableSearch" placeholder="üîç Search... Try: weight:>500, weight:100-500, PLA" aria-label="Search filaments" title="Math filters: weight:>500, weight:<200, weight:100-500, weight:=1000">
                            </div>
                            <div class="data-grid-pagination">
                                <button id="filamentGridPrev" disabled aria-label="Previous page">‚Äπ</button>
                                <span class="pagination-info" id="filamentGridInfo">0-0 of 0</span>
                                <button id="filamentGridNext" disabled aria-label="Next page">‚Ä∫</button>
                            </div>
                        </div>
                        <div class="search-results-info" id="filamentSearchResults" style="display: none;"></div>
                        <div class="table-container">
                            <table id="filamentTable" class="data-grid-table">
                                <thead>
                                    <tr>
                                        <th scope="col" data-column="brand" class="sortable-header">Brand</th>
                                        <th scope="col" data-column="materialType" class="sortable-header">Material Type</th>
                                        <th scope="col" data-column="colorName" class="sortable-header">Color</th>
                                        <th scope="col" data-column="weight" class="sortable-header">Weight (g)</th>
                                        <th scope="col" data-column="inStock" class="sortable-header">Status</th>
                                        <th scope="col" data-column="location" class="sortable-header">Location</th>
                                        <th scope="col" data-column="actions" class="sortable-header">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="filamentTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                    <div id="duplicateWarning" class="warning-message" role="alert" aria-live="polite" style="display: none;">
                        <p>Duplicate filament detected. Would you like to merge with existing entry or create new one?</p>
                        <button id="mergeDuplicateBtn">Merge</button>
                        <button id="createNewBtn">Create New</button>
                        <button id="cancelDuplicateBtn">Cancel</button>
                    </div>
                </div>
            </div>

            <div id="models-page" class="page">
                <h1>Models Library</h1>
                <div class="section">
                    <h2>Import/Export Data</h2>
                    <button onclick="exportData()">Export All Data</button>
                    <button class="export-btn" onclick="document.getElementById('importFile2').click()">Import Data</button>
                    <input type="file" id="importFile2" accept=".json" style="display: none;">
                </div>
                <div class="section">
                    <div class="section-header" onclick="toggleSection('addModelSection')">
                        <h2>Add New Model</h2>
                        <span class="toggle-icon" id="addModelSection-toggle">‚ñº</span>
                    </div>
                    <div id="addModelSection" class="section-content collapsible" style="max-height: 0px; overflow: hidden;">
                        <form id="modelForm" aria-label="Add new model">
                            <div class="input-group">
                                <div class="form-group">
                                    <label for="modelName" id="modelNameLabel">Model Name</label>
                                    <input type="text" id="modelName" name="modelName" placeholder="Model name" required aria-required="true">
                                </div>
                                <div class="form-group">
                                    <label for="modelLink" id="modelLinkLabel">Source URL / Notes</label>
                                    <input type="url" id="modelLink" name="modelLink" placeholder="https://example.com/model or notes">
                                </div>
                                <div class="form-group">
                                    <label for="modelCategory" id="modelCategoryLabel">Category</label>
                                    <select id="modelCategory" name="category" required aria-required="true">
                                        <option value="">Select Category...</option>
                                        <option value="Functional">Functional</option>
                                        <option value="Decoration">Decoration</option>
                                        <option value="Tools">Tools</option>
                                        <option value="Toys">Toys</option>
                                        <option value="Art">Art</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="modelDifficulty" id="modelDifficultyLabel">Difficulty Level</label>
                                    <select id="modelDifficulty" name="difficulty" required aria-required="true">
                                        <option value="">Select Difficulty...</option>
                                        <option value="Easy">Easy</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Hard">Hard</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="modelPrintTime" id="modelPrintTimeLabel">Estimated Print Time (minutes)</label>
                                    <input type="number" id="modelPrintTime" name="printTime" placeholder="120" min="0" max="1440" aria-describedby="printTimeHelp">
                                    <small id="printTimeHelp" class="form-help">Estimated printing time in minutes (max: 24 hours)</small>
                                </div>
                                <div class="form-group">
                                    <label for="modelLayerHeight" id="modelLayerHeightLabel">Recommended Layer Height (mm)</label>
                                    <input type="number" id="modelLayerHeight" name="layerHeight" placeholder="0.2" min="0.05" max="1.0" step="0.05" aria-describedby="layerHeightHelp">
                                    <small id="layerHeightHelp" class="form-help">Layer height between 0.05mm and 1.0mm</small>
                                </div>
                                <div class="form-group">
                                    <label for="modelInfill" id="modelInfillLabel">Recommended Infill (%)</label>
                                    <input type="number" id="modelInfill" name="infill" placeholder="20" min="0" max="100" step="5" aria-describedby="infillHelp">
                                    <small id="infillHelp" class="form-help">Infill percentage (0-100%)</small>
                                </div>
                                <div class="form-group">
                                    <label for="modelSupports" id="modelSupportsLabel">Supports Required</label>
                                    <select id="modelSupports" name="supportsRequired" required aria-required="true">
                                        <option value="false">No</option>
                                        <option value="true">Yes</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="modelNotes" id="modelNotesLabel">Printing Notes</label>
                                    <textarea id="modelNotes" name="notes" rows="3" placeholder="Additional printing notes, tips, or observations"></textarea>
                                </div>
                            </div>
                            <div style="margin-bottom:15px;">
                                <label style="display:block;margin-bottom:10px;font-weight:600;color:#495057;">Required Filaments:</label>
                                <div id="requiredFilamentsContainer"></div>
                                <button type="button" class="add-req-btn" onclick="addFilamentRequirement()">+ Add Filament</button>
                            </div>
                            <div class="form-actions">
                                <button type="submit" id="addModelBtn">Add Model</button>
                                <button type="button" id="cancelModelBtn" style="display: none;">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="section">
                    <h2>Model Database</h2>
                    <div id="modelGridWrapper">
                        <div class="data-grid-controls">
                            <div class="category-management">
                                <div class="category-chips" id="modelCategoryChips">
                                    <!-- Categories will be dynamically added here -->
                                </div>
                                <button type="button" id="manageCategoriesBtn" class="manage-categories-btn">‚öôÔ∏è Categories</button>
                            </div>
                            <div class="data-grid-search">
                                <input type="text" id="modelTableSearch" placeholder="üîç Search models..." aria-label="Search models">
                            </div>
                            <div class="data-grid-pagination">
                                <button id="modelGridPrev" disabled aria-label="Previous page">‚Äπ</button>
                                <span class="pagination-info" id="modelGridInfo">0-0 of 0</span>
                                <button id="modelGridNext" disabled aria-label="Next page">‚Ä∫</button>
                            </div>
                        </div>
                        <div class="search-results-info" id="modelSearchResults" style="display: none;"></div>
                        <div class="table-container">
                            <table id="modelTable" class="data-grid-table">
                                <thead>
                                    <tr>
                                        <th scope="col" data-column="name" class="sortable-header">Model Name</th>
                                        <th scope="col" data-column="category" class="sortable-header">Category</th>
                                        <th scope="col" data-column="difficulty" class="sortable-header">Difficulty</th>
                                        <th scope="col" data-column="requiredFilaments" class="sortable-header">Required Filaments</th>
                                        <th scope="col" data-column="printTime" class="sortable-header">Est. Time</th>
                                        <th scope="col" data-column="canPrint" class="sortable-header">Can Print?</th>
                                        <th scope="col" data-column="link" class="sortable-header">Link/Notes</th>
                                        <th scope="col" data-column="actions" class="sortable-header">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="modelTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="prints-page" class="page">
                <h1>Print History</h1>
                <div class="section">
                    <h2>Record New Print</h2>
                    <div class="input-group">
                        <div class="model-search-container">
                            <input type="text" id="printModel" placeholder="Search models..." class="model-search-input" title="Search for models by name, category, or difficulty">
                            <div class="model-search-results"></div>
                        </div>
                        <input type="number" id="printWeight" placeholder="Total Weight Used (g)" min="0" step="0.1" readonly style="background: #f8f9fa; cursor: not-allowed;" title="Total weight calculated from individual filament weights">
                        <input type="date" id="printDate" title="Print date (defaults to today)">
                    </div>
                    <div style="margin-top:15px;">
                        <label style="display:block;margin-bottom:10px;font-weight:600;color:#495057;">Filaments Used:</label>
                        <div id="printFilamentsContainer"></div>
                        <button type="button" class="add-req-btn" onclick="addPrintFilament()">+ Add Filament</button>
                    </div>
                    <button onclick="addPrint()">Record Print</button>
                </div>
                <div class="section">
                    <h2>Print History</h2>
                    <table id="printTable">
                        <thead>
                            <tr><th>Date</th><th>Model</th><th>Color</th><th>Weight (g)</th><th>Action</th></tr>
                        </thead>
                        <tbody id="printTableBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="stats-page" class="page">
                <h1>Statistics & Analysis</h1>
                <div class="section">
                    <h2>Usage Statistics</h2>
                    <div id="usageStats"></div>
                </div>
                <div class="section">
                    <h2>Printable Models</h2>
                    <p style="color:#6b7280;margin-bottom:15px;">Models you can print with current inventory:</p>
                    <div id="printableModels"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="editFilamentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Edit Filament</div>
            <form id="editFilamentForm" aria-label="Edit filament details">
                <div class="input-group">
                    <div class="form-group">
                        <label for="editFilamentBrand">Brand</label>
                        <input type="text" id="editFilamentBrand" name="brand" placeholder="Manufacturer" required>
                    </div>
                    <div class="form-group">
                        <label for="editFilamentMaterialType">Material Type</label>
                        <select id="editFilamentMaterialType" name="materialType" required>
                            <option value="">Select Type...</option>
                            <option value="PLA">PLA</option>
                            <option value="PETG">PETG</option>
                            <option value="ABS">ABS</option>
                            <option value="TPU">TPU</option>
                            <option value="Other">Other (Custom)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editFilamentColor">Color Name</label>
                        <input type="text" id="editFilamentColor" name="colorName" placeholder="Color description" required>
                    </div>
                    <div class="form-group">
                        <label for="editFilamentColorHex">Color Code</label>
                        <div class="enhanced-color-input-wrapper">
                            <input type="text" id="editFilamentColorHex" name="colorHex" placeholder="#RRGGBB" value="#ff5733"
                                   class="enhanced-color-input" maxlength="7"
                                   pattern="^#[0-9A-Fa-f]{6}$"
                                   aria-label="Color hex code">
                            <div class="enhanced-color-swatch" id="editFilamentColorSwatch" style="background: #ff5733" data-hex="#FF5733"></div>
                            <button type="button" class="color-picker-btn" id="editFilamentColorPickerBtn" title="Open color picker">üé®</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="editFilamentDiameter">Diameter</label>
                        <select id="editFilamentDiameter" name="diameter" required>
                            <option value="1.75">1.75mm</option>
                            <option value="2.85">2.85mm</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editFilamentWeight">Weight (g)</label>
                        <input type="number" id="editFilamentWeight" name="weight" placeholder="Current weight" min="0" step="0.1" required>
                    </div>
                    <div class="form-group">
                        <label for="editFilamentLocation">Storage Location</label>
                        <input type="text" id="editFilamentLocation" name="location" placeholder="Storage location">
                    </div>
                    <div class="form-group">
                        <label for="editFilamentPurchasePrice">Purchase Price ($/kg)</label>
                        <input type="number" id="editFilamentPurchasePrice" name="purchasePrice" placeholder="Optional price per kg" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="editFilamentInStock" name="inStock" value="true">
                            In Stock?
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <fieldset>
                        <legend>Temperature Range (¬∞C)</legend>
                        <div class="temp-range-inputs">
                            <label for="editFilamentTempMin">Min:</label>
                            <input type="number" id="editFilamentTempMin" name="tempMin" min="150" max="350" placeholder="150" maxlength="7">
                            <span class="temp-separator">-</span>
                            <label for="editFilamentTempMax">Max:</label>
                            <input type="number" id="editFilamentTempMax" name="tempMax" min="150" max="350" placeholder="250" maxlength="7">
                        </div>
                    </fieldset>
                </div>
                <div class="form-group">
                    <label for="editFilamentNotes">Notes</label>
                    <textarea id="editFilamentNotes" name="notes" rows="3" placeholder="Additional notes about this filament"></textarea>
                </div>
            </form>
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeEditFilamentModal()">Cancel</button>
                <button type="button" onclick="saveEditFilament()">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="editModelModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Edit Model</div>
            <div class="input-group">
                <input type="text" id="editModelName" placeholder="Model Name" required>
                <input type="url" id="editModelLink" placeholder="Link/URL">
            </div>
            <div class="input-group">
                <select id="editModelCategory">
                    <option value="">Select Category...</option>
                    <option value="Functional">Functional</option>
                    <option value="Artistic">Artistic</option>
                    <option value="Educational">Educational</option>
                    <option value="Prototype">Prototype</option>
                    <option value="Replacement Part">Replacement Part</option>
                    <option value="Toy/Gift">Toy/Gift</option>
                    <option value="Other">Other</option>
                </select>
                <select id="editModelDifficulty">
                    <option value="">Select Difficulty...</option>
                    <option value="Easy">Easy</option>
                    <option value="Medium">Medium</option>
                    <option value="Hard">Hard</option>
                    <option value="Expert">Expert</option>
                </select>
            </div>
            <div class="input-group">
                <input type="number" id="editModelPrintTime" placeholder="Print Time (hours)" min="0.5" max="500" step="0.5">
                <input type="number" id="editModelLayerHeight" placeholder="Layer Height (mm)" min="0.05" max="1.0" step="0.05">
            </div>
            <div class="input-group">
                <input type="number" id="editModelInfill" placeholder="Infill (%)" min="0" max="100" step="5">
                <select id="editModelSupports">
                    <option value="false">No Supports</option>
                    <option value="true">Requires Supports</option>
                </select>
            </div>
            <div style="margin-top:15px;">
                <label style="display:block;margin-bottom:10px;font-weight:600;color:#495057;">Required Filaments:</label>
                <div id="editRequiredFilamentsContainer"></div>
                <button type="button" class="add-req-btn" onclick="addEditFilamentRequirement()">+ Add Filament</button>
            </div>
            <div style="margin-top:15px;">
                <label for="editModelNotes" style="display:block;margin-bottom:10px;font-weight:600;color:#495057;">Notes:</label>
                <textarea id="editModelNotes" rows="3" style="width:100%;padding:8px;border:1px solid #ced4da;border-radius:4px;"></textarea>
            </div>
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeEditModelModal()">Cancel</button>
                <button onclick="saveEditModel()">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="categoryManagementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Manage Categories</div>
            <div class="category-list" id="categoryList">
                <!-- Categories will be displayed here -->
            </div>
            <div class="add-category-form">
                <div class="input-group">
                    <input type="text" id="newCategoryName" placeholder="New category name..." aria-label="New category name">
                    <button type="button" id="addCategoryBtn" onclick="addCategory()">Add</button>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeCategoryModal()">Done</button>
            </div>
        </div>
    </div>

    <div id="editPrintModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Edit Print Record</div>
            <div class="input-group">
                <input type="text" id="editPrintModel" placeholder="Model Name">
                <input type="text" id="editPrintColor" placeholder="Color">
                <input type="number" id="editPrintWeight" placeholder="Weight (g)" min="0" step="0.1">
                <input type="date" id="editPrintDate">
            </div>
            <div class="modal-buttons">
                <button class="cancel-btn" onclick="closeEditPrintModal()">Cancel</button>
                <button onclick="saveEditPrint()">Save Changes</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>